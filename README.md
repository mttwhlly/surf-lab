# 🌊 SURF LAB - AI Surf Report

A clean, minimal surf forecasting application that provides AI-generated surf reports for St. Augustine, Florida. Built with Next.js, TypeScript, and powered by OpenAI to deliver conversational surf reports in the voice of a local surfer.

## 🚀 Features

- **AI-Powered Surf Reports**: Natural language surf reports generated by OpenAI GPT-4 in the voice of a local surfer
- **Real-time Data Integration**: Live wave height, period, wind conditions, and NOAA tide information
- **Smart Caching**: Database-backed caching with 4-hour report cycles and 5-minute data updates
- **Progressive Web App**: Installable PWA with offline support and service worker caching
- **Automated Updates**: Cron jobs refresh data 4 times daily at optimal surf check times
- **Mobile-First Design**: Clean, responsive interface optimized for quick surf checks

## 🛠️ Tech Stack

- **Frontend**: Next.js 14, React, TypeScript, Tailwind CSS
- **Backend**: Next.js API Routes, Vercel AI SDK (OpenAI)
- **Database**: Neon PostgreSQL for surf report caching
- **AI**: OpenAI GPT-4 Mini for generating conversational surf reports
- **Data Sources**: 
  - Open-Meteo API for marine and weather data
  - NOAA Tides & Currents API for real-time tide information
- **State Management**: TanStack Query for data fetching and caching
- **Deployment**: Vercel with automated cron jobs for data refresh

## 📦 Installation

### Prerequisites

- Node.js 18.17 or later
- npm, yarn, or pnpm
- Neon PostgreSQL database
- OpenAI API key

### Environment Variables

Create a `.env.local` file in the root directory:

```env
# Database
NEON_DATABASE_URL="postgresql://username:password@ep-xxx.us-east-1.aws.neon.tech/neondb?sslmode=require"

# OpenAI
OPENAI_API_KEY="sk-..."

# Cron Security (for automated updates)
CRON_SECRET="your-secure-random-string"

# Optional
NEXT_PUBLIC_API_URL="https://your-domain.com"
```

### Setup

1. **Clone the repository**:
```bash
git clone <your-repo-url>
cd surf-lab
```

2. **Install dependencies**:
```bash
npm install
```

3. **Set up the database**:
```bash
npm run setup-db
```

4. **Run the development server**:
```bash
npm run dev
```

5. **Open** [http://localhost:3000](http://localhost:3000) to view the app

## 🏗️ Project Structure

```
src/app/
├── api/
│   ├── surfability/              # Real-time surf conditions API
│   ├── surf-report/              # AI-generated reports API
│   ├── health/                   # Health check endpoint
│   └── admin/request-forecast/   # Cron job endpoint for data refresh
├── components/
│   ├── surf/                     # Surf-specific components
│   │   ├── SurfReportCard.tsx    # Main AI report display
│   │   ├── StatusCard.tsx        # Surf rating and score (unused)
│   │   ├── WeatherHeader.tsx     # Weather info (unused)
│   │   ├── SurfDetails.tsx       # Detailed conditions (unused)
│   │   └── TideCard.tsx          # Tide information (unused)
│   ├── ui/                       # Reusable UI components
│   │   ├── Card.tsx              # Base card component
│   │   ├── Toast.tsx             # Notification component
│   │   ├── LoadingShimmer.tsx    # Loading states
│   │   └── ErrorCard.tsx         # Error handling
│   └── animations/               # Visual animations (unused)
├── hooks/                        # Custom React hooks
│   ├── useSurfData.ts           # Surf conditions hook (unused)
│   └── useSurfReport.ts         # AI report hook
├── lib/                         # Utilities and database
│   ├── db.ts                    # Neon database functions
│   └── utils.ts                 # Utility functions
├── providers/
│   └── QueryProvider.tsx        # TanStack Query setup
├── types/                       # TypeScript definitions
│   ├── surf.ts                  # Surf data types
│   └── surf-report.ts           # AI report types
├── globals.css                  # Global styles
├── layout.tsx                   # App layout with providers
└── page.tsx                     # Main app page (simplified)
```

**Note**: The current implementation focuses on AI surf reports. Many components for detailed conditions and visualizations exist but are not actively used in the main interface.

## 🔄 Data Flow

1. **Cron Jobs**: Automated refresh 4 times daily (5 AM, 9 AM, 1 PM, 4 PM ET)
2. **Surf Conditions**: Fetched from Open-Meteo marine API and NOAA tides via `/api/surfability`
3. **AI Report Generation**: Current conditions processed by OpenAI GPT-4 Mini via `/api/surf-report`
4. **Database Caching**: Reports cached in Neon PostgreSQL for 2 hours (was 4 hours)
5. **Frontend**: TanStack Query fetches AI reports with 4-hour cache and automatic refetch
6. **User Interface**: Clean, minimal display focusing on the AI-generated surf report

**Current State**: The app primarily displays AI surf reports. While detailed surf condition components exist in the codebase, the main interface focuses on the conversational AI report for simplicity.

## 🎯 API Endpoints

- `GET /api/surf-report` - AI-generated surf report (main endpoint, cached 2 hours)
- `GET /api/surfability` - Real-time surf conditions and scoring (used by AI generation)
- `GET /api/health` - Service health check
- `GET /api/admin/request-forecast` - Cron job endpoint for cache clearing and data refresh

**Authentication**: Cron endpoint requires `CRON_SECRET` or Vercel cron headers for security.

## 🚀 Deployment

### Vercel (Recommended)

1. **Connect your repository** to Vercel
2. **Set environment variables** in Vercel dashboard
3. **Deploy** - Vercel will automatically build and deploy

### Cron Jobs

Add these cron expressions in Vercel dashboard to hit `/api/admin/request-forecast`:

```bash
# 4 times daily updates (Eastern Time)
0 9 * * *    # 5:00 AM ET (9:00 UTC)
0 13 * * *   # 9:00 AM ET (13:00 UTC)  
0 17 * * *   # 1:00 PM ET (17:00 UTC)
0 20 * * *   # 4:00 PM ET (20:00 UTC)
```

Each cron job clears cached reports and generates fresh data.

### Manual Deployment

```bash
# Build for production
npm run build

# Start production server
npm start
```

## 🎨 Customization

### Surf Location

To change from St. Augustine, FL to another location:

1. **Update coordinates** in `/api/surfability/route.ts`:
```typescript
const marineRes = await fetch(
  'https://api.open-meteo.com/v1/marine?latitude=YOUR_LAT&longitude=YOUR_LON&...'
);
```

2. **Update NOAA station ID** for tides:
```typescript
const stationId = 'YOUR_NOAA_STATION_ID'; // Find at tidesandcurrents.noaa.gov
```

3. **Update location references** in AI prompts and database queries

### AI Report Customization

Modify the prompt in `/api/surf-report/route.ts` to change:
- **Voice & tone** (local vs. professional, casual vs. technical)
- **Content focus** (beginner tips, advanced analysis, safety warnings)
- **Surf spots** (update spot recommendations for your area)
- **Local knowledge** (tides, winds, seasonal patterns specific to your region)

### Enabling Additional Components

To show detailed surf conditions alongside the AI report, edit `src/app/page.tsx`:

```typescript
// Add these imports and components to page.tsx
import { useSurfData } from './hooks/useSurfData';
import { StatusCard } from './components/surf/StatusCard';
import { WeatherHeader } from './components/surf/WeatherHeader';
import { SurfDetails } from './components/surf/SurfDetails';
import { TideCard } from './components/surf/TideCard';

// Then include them in your JSX alongside SurfReportCard
```

## 📱 PWA Features

- **Offline Support**: Service worker caches data and provides fallbacks
- **Install Prompt**: Can be installed as a native app
- **Push Notifications**: Ready for surf condition alerts (requires setup)
- **Optimized Performance**: Lazy loading, image optimization, code splitting

## 🔧 Available Scripts

- `npm run dev` - Start development server
- `npm run build` - Build for production
- `npm run start` - Start production server
- `npm run lint` - Run ESLint
- `npm run setup-db` - Initialize Neon database
- `npm run type-check` - TypeScript type checking

## 🌊 Data Sources

- **Marine Data**: [Open-Meteo Marine API](https://open-meteo.com/en/docs/marine-weather-api)
- **Weather Data**: [Open-Meteo Weather API](https://open-meteo.com/en/docs)
- **Tide Data**: [NOAA Tides & Currents API](https://tidesandcurrents.noaa.gov/api/)
- **AI Reports**: [OpenAI GPT-4 Mini](https://platform.openai.com/)

## 📊 Performance

- **Lighthouse Score**: 95+ across all metrics
- **Core Web Vitals**: Optimized for speed and user experience  
- **Caching Strategy**: Multi-layer caching (API, database, service worker)
- **Bundle Size**: Optimized with code splitting and tree shaking

## 🤝 Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## 🐛 Troubleshooting

### Common Issues

**Database Connection Errors**:
- Verify `NEON_DATABASE_URL` is correct
- Check database permissions and SSL settings

**OpenAI API Errors**:
- Verify `OPENAI_API_KEY` is valid
- Check API quota and billing

**Cron Jobs Not Running**:
- Verify `CRON_SECRET` is set in environment
- Check Vercel cron configuration

### Debug Mode

Add to `.env.local` for detailed logging:
```env
NODE_ENV=development
```

## 📄 License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## 🙏 Acknowledgments

- [Open-Meteo](https://open-meteo.com/) for free marine weather data
- [NOAA](https://tidesandcurrents.noaa.gov/) for tide information
- [OpenAI](https://openai.com/) for AI-powered surf reports
- [Vercel](https://vercel.com/) for seamless deployment and hosting
- The wonderful beaches and beach community of St. Augustine, FL

---

**Made with 🌊 for surfers, by surfers**

For questions or support, please open an issue on GitHub.